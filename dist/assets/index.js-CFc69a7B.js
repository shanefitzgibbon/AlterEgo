import{S as s}from"./storage-CbI5T85I.js";console.log("AlterEGo Background Service Worker Started");chrome.runtime.onInstalled.addListener(async()=>{console.log("AlterEGo Installed"),(await s.getPersonas()).length===0&&console.log("No personas found. Initial state.")});chrome.sidePanel.setPanelBehavior({openPanelOnActionClick:!0}).catch(e=>console.error(e));chrome.storage.onChanged.addListener(async(e,i)=>{if(i==="local"&&e.activePersonaId){const t=e.activePersonaId.newValue,n=e.activePersonaId.oldValue;if(console.log(`Switching persona from ${n} to ${t}`),n){const a=await chrome.cookies.getAll({});await s.saveCookies(n,a),console.log(`Saved ${a.length} cookies for persona ${n}`)}if(await chrome.browsingData.remove({since:0},{cookies:!0,localStorage:!0,cache:!0}),console.log("Cleared browsing data"),t){const a=await s.getCookies(t);console.log(`Restoring ${a.length} cookies for persona ${t}`);for(const o of a){const c=o.secure?"https://":"http://",r=o.domain.startsWith(".")?o.domain.substring(1):o.domain,l=`${c}${r}${o.path}`;try{await chrome.cookies.set({url:l,name:o.name,value:o.value,domain:o.domain,path:o.path,secure:o.secure,httpOnly:o.httpOnly,expirationDate:o.expirationDate,storeId:o.storeId})}catch(d){console.warn(`Failed to set cookie ${o.name} for ${r}:`,d)}}}console.log("Persona switch complete.")}});
